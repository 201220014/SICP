---
description: 程序的元素
---

# 🎡 程序的元素

## 概述

一门编程语言并不只是一种指导计算机完成任务的手段，它同时也是我们**组织自己想法的一个框架**。程序同时也是编程者们相互交流的一种方式，也正因如此，我们编写的程序必须是让人来读的，只不过它刚好也可以被机器运行罢了。人永远比机器重要。

当我们描述一种语言的时候，我们应该重点关注，这种语言提供了怎样的手段让我们能够将简单的想法结合起来从而形成更加复杂的想法。每一种高级的编程语言都有如下三种基本的手段：

* **基础表达式和语句**：它们代表了这门语言提供的最简单的砖块，也是我们日后构建复杂程序最基本的建材；
* **结合的手段**：复杂的元素是由简单的元素通过这些结合的手段形成的；
* **抽象的方法**：通过这些抽象的方法，复杂的元素应当能够被当成一个整体来进行命名与操作。

在程序中，我们会处理两种元素：函数与数据。（不久之后，我们会发现，此二者的区别并不是绝对的，两者相差无几。）简单来说，数据是我们想要操作的东西，函数描述了我们操作数据的规则与过程。

因此，任何的高级程序设计语言都应当能够描述一些基本的数据（比如整数与小数）和函数（比如加减乘除之类的数学运算），同时也应当拥有一些将数据和函数结合起来、抽象起来的方法。

## 表达式（Expressions）

从此处开始，我们将一点一点地基于Python语言搭建程序的大厦，起初会比较简单，请保持耐心，平凡之后的卓越将在不久后到来。

我们先从**基本表达式（Primitive Expression）**开始。一种基本的表达式是一个数字，更加准确地说，是一个仅由阿拉伯数字符号组成的十进制数。

```python
>>> 42
42
```

仅由数字组成的基本表达式可以通过数学符号相联结，形成一个复杂一点的**复合表达式（Compound Expression）**，解释器将会**评估(evaluate)**这个表达式的值：

```python
>>> -1 - -1
0
>>> 1/2 + 1/4 + 1/8 + 1/16 + 1/32 + 1/64 + 1/128
0.9921875
```

这些数学表达式使用了**中缀(infix)表示法**，**操作符**（**operator**，比如说`+, -, *, /`）出现在**操作数**（**operands**，比如说数字）之间。Python中囊括了很多形成复合表达式的方法。我们不会一下子把它们都枚举出来，而是在我们不断深入的过程中逐渐引入新的表达式形式。并且与此同时，也慢慢加入Python语言所支持的特性。

{% hint style="info" %}
表达式是一个能够导出值的东西，只要在Python交互式解释器中能够返回值的都是表达式。
{% endhint %}

## 调用表达式（Call Expression）

调用表达式是最重要的一种复合表达式了，它将一个函数作用于一些参数。从代数的角度来看，函数是从一些输入参数到一个输出值之间的映射。Python表示函数作用的记号和传统的数学记号一样：

```python
>>> max(7.5, 9.5)
9.5
```

调用表达式是含有**子表达式（subexpressions）**的，它由括号外面的操作符与括号里面的操作数列表组成，每一个操作符或者操作数本身也是一个表达式。

> 这里需要理解一下，表达式是一个返回值的东西，无论这个值是一个数据还是一个过程。

```
    max     (     7.5    ,      9.5    )
>----------< >----------<  >----------<
  Operator      Operand        Operand
```

操作符表示了一个函数过程。当这个调用表达式被**评估（evaluate）**的时候，我们称函数`max`被调用了，实际参数（简称实参，**argument**）为7.5和9.5，返回值为9.5。

在调用表达式中，实参的顺序是有考量的。比如说，`pow`函数，一个求指数的函数，`pow(a, b`返回$$a^b$$。

```python
>>> pow(100, 2) # 100^2
10000
>>> pow(2, 100) # 2^100
1267650600228229401496703205376
```

相比于中缀形式的数学表示法，这种**函数调用（function call）**的表示法有3个主要的优点：

第一，函数可以有任意个数的参数，并且不会有歧义，因为函数名永远在参数前面。

```python
>>> max(1, -2, 3, -4)
3
```

第二，函数调用表示法拓展了一种十分直接的方式来**嵌套表达式（nested expressions）**。嵌套表达式是指表达式的操作符或者操作数中存在某一项本身也是一个表达式。

> 因为表达式本身就只是一个返回值的东西罢了，所以我们需要值的时候就可以用一个表达式来替代，从而形成了更复杂的嵌套表达式。

```python
>>> max(min(1, -2), min(pow(3, 5), -4)
-2
```

原则上嵌套表达式的深度以及复杂程度是没有限制的，无论多么复杂，python解释器应当总是能够评估出这个嵌套表达式的值的。然而，人类可能在这样的复杂嵌套面前很容易就变得迷惑了。

不过，对于作为编程者的你来说，你应当尽自己所能，来组织表达式的结构，使得它能够被你自己解释读懂，能够被与你一起合作编程的伙伴们读懂，能够被未来可能会阅读你的表达式的其他人读懂。

第三，数学表达式有着大量繁杂的符号体系，各种运算符、各种上下标、各种上划线、下划线、向量的表示、求和的表示、根号、分式......这些一方面不容易记忆，另一方面也不太容易用我们的键盘打出来。然而，所有的这些复杂的记号都可以通过调用表达式的方式来描述。Python本身也支持许多常用数学符号的调用表达式形式（比如加法`add`，求根号`sqrt`等等）。任何的操作符都可以被表达成一个带名字的函数。

## 引入库函数

Python定义了非常多的函数，包括上一节提到的各种操作符对应的函数。但是，Python没有默认这些函数都可以直接使用。相反，Python将这些内置的函数，以及其它一些东西按照逻辑上的关联性组织成了许多的模块，这些模块结合起来就组成了Python的**库（library）**。比如说，`math`模块提供了大量常用的数学函数：

```python
>>> from math import sqrt
>>> sqrt(256)
16.0
```

再比如说，`operator`模块提供了许多与中缀操作符相对应函数：

```python
>>> from operator import add, sub, mul
>>> add(14, 28)
42
>>> sub(100, mul(7, add(8, 4)))
16
```

一个`import`语句一般先指定一个模块的名字（比如说`operator`或者`math`），然后列出我们所需要的具体成分（比如说平方根`sqrt`，或者圆周率`pi`）。一旦一个函数或者变量被引入了，它可以被调用或者使用很多次。

使用操作符函数与使用操作符符号，这两者本质上没有任何区别，只不过是写法不一样而已。一般情况下，大多数程序员会使用符号与中缀表示法来书写简单的代数表达式。

Python3库文档里面列出了Python所有的内置模块以及每个模块的所有成分。链接如下：

{% embed url="https://docs.python.org/3/library/index.html" %}
python3 标准库文档
{% endembed %}

不过，这个文档是为已经熟知整个python语言的开发者写的。如果读者是python的初学者，可能相比于读文档，直接上手敲一敲这个函数能够告诉你更多关于这个函数你想知道的东西。在你慢慢熟悉了Python语言之后，这份文档将会变成一个宝贵的参考资料。

## 名字(Name)与环境(Environment)

一门编程语言非常重要的地方在于，它提供了一种方式或者说手段，能够让我们用一个名字简单地指代某个可以计算的对象。如果一个值被给予了一个名字，我们称这个**名字(name)**和这个**值(value)**被**绑定(bind)**在了一起。

在Python中，我们可以通过**赋值语句(Assignment Statement)**的方式来建立新的绑定，包括`=`左边的名字和`=`右边的值：

```python
>>> radius = 10
>>> radius
10
>>> 2 * radius
20
```

{% hint style="info" %}
这里我们可以看到，当我们在交互式解释器中输入radius = 10的时候，python并没有给我们返回任何值，这也就说明了radius = 10不是表达式，因为表达式是一个返回值的东西。

所以我们称python中的赋值为赋值语句，而不是赋值表达式，这与C/C++是不同的。
{% endhint %}

通过`import`语句也可以建立名字与值之间的绑定：

```python
>>> from math import pi
>>> pi * 71 / 223
1.0002380197528042
```

在Python中（其实许多别的语言也是这样的），`=`符号被称为赋值操作符。复制操作是我们最简单的**抽象(abstraction)**方式，因为它使得我们能够用一个简单的名字来指代一系列复杂操作的结果，比如说上面的面积。

通过这样的方式，复杂的程序可以一步一步的被搭建起来，通过不断计算结果，然后用名字指代结果，再计算更复杂的结果的方式。

能够将名字和值绑定在一起，并在之后通过名字来访问值，这就说明了Python解释器必须维护一小块内存，这个内存中存放了名字、值以及名字和值之间的绑定关系。简单来说，就是需要维持一张**名值表（name-value table）**。这一小块内存，也就是这一张名值表，我们称之为**环境（environment）**。

名字也可以被绑定到函数。比如说，名字`max`就被绑定到了最大值函数。不过函数不像数字，可能不是很方便用文本表示，所以当我们询问一个函数的名字的时候（名字本身也是表达式，而表达式是一个返回值的东西）Python解释器会给我们一个像身份证一样的标识信息，比如说：

```python
>>> max
<built-in function max>
```

我们可以用赋值语句给已经存在的函数一个新的名字，就像普通的变量一样：

```cpp
>>> f = max
>>> f
<built-in function max>
>>> f(2, 3, 4)
4
```

并且后续的赋值语句可以将一个名字重新绑定到一个新的值:

```python
>>> f = 2
>>> f
2
```

{% hint style="info" %}
从上面的叙述中，我们可以隐约感知到，函数本身也是一个值，它和普通的数值数据似乎地位上是平等的，此处暂时按下不表，后续会有详细的相关内容。
{% endhint %}

在Python中，名字一般被称为**变量（variable）**或者**变量名（variable name）**，因为它们在程序执行的过程中可以被绑定到许多不同的值。当一个变量被绑定到一个新的值的时候，它之前的绑定就不存在了，无法再通过它去访问任何一个它之前绑定过的值了。哪怕是内置的名字也是可以被绑定到新的值的。

```python
>>> max = 5
>>> max
5
```

再把`max`这个名字绑定到5的时候，它就不再绑定到之前的最大值函数了，所以，后续任何的想要调用`max(2, 3, 4)`的尝试都会导致一个错误。

当执行一个赋值语句的时候，Python在将`=`右边的值绑定到等号左边的名字之前，会先评估等号右边的表达式，从而得到一个值（再说一遍，表达式是一个返回值的东西）。也就是说，在`=`右边我们仍然可以使用等号左边的名字去指代值，哪怕这个绑定关系即将被改变，但至少在评估右侧表达式的值的时候原绑定关系还是存在的。

```python
>>> x = 2
>>> x = x + 1
>>> x
3
```

我们也可以在一个赋值语句中完成多次赋值，只需要将对应的名字和值放在`=`的左右侧，依次排列用逗号隔开即可。

```python
>>> area, circumference = pi * radius * radius, 2 * pi * radius
>>> area
314.1592653589793
>>> circumference
62.83185307179586
```

改变一个名字的值并不会影响其他的名字。





